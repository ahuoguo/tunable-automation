# Tunable Automation

Artifact for the paper "Tunable Automation in Automated Program Verification"

## Dependencies

We require a working version of `rustup`, `python3`, `ninja`, as Verus and Mariposa depend on them.

## Minimizing Verus Projects

We do not include scripts to minimize several Verus project as they can take days. We provide the logs and minimized projects under `experiments/minimized`, the minimized projects after broadcasting.

Here's the path of the logs for minimization:

```
./experiments/broadcast-from-main/verified-ironkv/ironsht/src/min.log
./experiments/broadcast-from-main/verified-betrfs/Splinter/src/min-after-brd.log
./experiments/broadcast-from-main/anvil/src/min-after-brd.log
./experiments/broadcast-from-main/verified-storage/osdi25/capybaraKV/brd-from-main.log1
./experiments/minimized/verified-ironkv/ironsht/src/min.log
./experiments/minimized/verified-betrfs/Splinter/src/min.log
./experiments/minimized/anvil/src/min.log
./experiments/minimized/verified-storage/osdi25/capybaraKV/capybarakv/src/deps_hack/min.log1
./experiments/all-triggers/verified-ironkv-min/ironsht/src/min-at.log
```

### Running Minimization by Yourself

The VerusMinimizer corresponding to each project is in the `verus/` folder. An example to use VerusMinimizer is

```
cd verus/minimizer/source/tools/minimize
cargo run --release -- -d ./tmp <path-to-tunable-automation>/experiments/original/verified-ironkv/ironsht/src/lib.d
```

Here, the `lib.d` file is generated by running Verus on the project with the `--emit=dep-info` flag. See more details in the `run.sh` script.

Since Anvil and VerifiedStorage needs their own `deps_hack` folder, we provide separate VerusMinimizer for them.

## Table 2

The VerusMinimizer can also count the number of asserts

```
cd verus/minimizer/source/tools/minimize 
cargo run --release -- -n <path-to-tunable-automation>/experiments/original/verified-ironkv/ironsht/src/lib.d

```

## Figure 3 Verification Time Ratio

The time logs can be replicated by `experiments/run.sh`. It will generate a `<project-name>.json` file in `experiments/original`, `experiments/minimized`, and `experiments/braodcast-from-main`.

Then running go to `json-time-cmp/` and run `generate-grphs.sh`. Figure 3 should be the same as `json-time-cmp/plot_all.png`

## Figure 4

```
cd failure-sample
./run.sh
./generate-graph.sh # This will generate `broadcast.png` corresponding to Figure 4
cd -
```

We also already include the logs from `./run.sh`, which are the under the following folders:

```
./failure-sample/ironkv/
./failure-sample/splinter/
./failure-sample/anvil/
./failure-sample/capybara/
```

So you can directly run `./generate-graph.sh` in `failure-sample/` to generate Figure 4.

## Figure 5

Figure 5 is only included in an extended version of the paper that studies impact of using #![all_triggers] on IronKV.

```
cd ./experiments/all-triggers/
./run.sh
cd ../json-time-cmp
python plot.py ../experiments/all-triggers/ironkv_at_min.json ../experiments/original/ironkv.json
cd ../failure-sample
python ./plot-all-scatter.py . all_triggers all_triggers
```

Similarly, we also include the logs from `./run.sh`, which are:

```
./experiments/all-triggers/ironkv_at_min.json
./failure-sample/ironkv_at/
```
